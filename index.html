<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Producer Toolkit</title>

  <!-- Mobile / app-like behaviour -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icon.png">

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --border: #d3d3dd;
      --text-main: #111111;
      --text-muted: #666666;
      --accent: #3b82f6;
      --accent-soft: #e0edff;

      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 24px 16px 40px;
      background: var(--bg);
      color: var(--text-main);
      transition: background 0.2s ease, color 0.2s ease;
    }

    body.dark {
      --bg: #05060a;
      --card-bg: #10121a;
      --border: #2a2f3a;
      --text-main: #f5f5f7;
      --text-muted: #a0a4b8;
      --accent: #60a5fa;
      --accent-soft: #132033;
    }

    header {
      margin-bottom: 16px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    h1 {
      font-size: 1.9rem;
      margin: 0 0 2px;
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin: 0;
    }

    .header-left {
      min-width: 0;
    }

    .theme-toggle {
      padding: 6px 12px;
      font-size: 0.85rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: #ffffff10;
      color: var(--text-main);
      white-space: nowrap;
    }

    .theme-toggle:hover {
      background: #ffffff20;
    }

    /* Tabs */
    .tabs {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 6px;
      margin-bottom: 14px;
      padding-bottom: 4px;
    }

    .tabs::-webkit-scrollbar {
      height: 4px;
    }
    .tabs::-webkit-scrollbar-thumb {
      background: #00000022;
      border-radius: 999px;
    }

    .tab-button {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.85rem;
      border: 1px solid var(--border);
      background: #ffffff10;
      color: var(--text-main);
      cursor: pointer;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .tab-button span.icon {
      font-size: 1rem;
    }

    .tab-button.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 600;
    }

    /* Panels */
    .panel {
      display: none;
      border-radius: 16px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      padding: 14px 14px 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      margin-bottom: 16px;
    }

    .panel.active {
      display: block;
    }

    h2 {
      font-size: 1.1rem;
      margin: 0 0 6px;
    }

    .panel-description {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin: 0 0 10px;
    }

    button {
      padding: 7px 14px;
      font-size: 0.9rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: #ffffff05;
      color: var(--text-main);
    }

    button.primary {
      border-color: var(--accent);
      background: var(--accent);
      color: #ffffff;
    }

    button.primary:hover {
      filter: brightness(0.96);
    }

    button:not(.primary):hover {
      background: #ffffff15;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    .card {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 8px 10px;
      background: var(--card-bg);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 4px;
    }

    .card-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .lock-btn {
      border-radius: 999px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 2px 6px;
      opacity: 0.4;
    }

    .lock-btn.locked {
      opacity: 1;
    }

    .card-content {
      font-size: 0.92rem;
      margin: 0;
    }

    .note {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    textarea {
      width: 100%;
      min-height: 90px;
      resize: vertical;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #ffffff05;
      color: var(--text-main);
      padding: 8px 9px;
      font-family: inherit;
      font-size: 0.88rem;
      margin-top: 8px;
    }

    .export-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .status {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 3px;
      min-height: 1em;
    }

    .deck-editor-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
      font-size: 0.85rem;
    }

    label {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    select {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #ffffff05;
      color: var(--text-main);
      font-size: 0.85rem;
    }

    @media (max-width: 600px) {
      body {
        padding-top: 18px;
      }
      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <h1>Producer Toolkit</h1>
      <p class="subtitle">Tap a tab, hit generate, or use Session Mode to walk through a full flow.</p>
    </div>
    <button class="theme-toggle" id="theme-toggle" type="button">‚òÄ Light</button>
  </header>

  <!-- Tab buttons with icons -->
  <nav class="tabs">
    <button class="tab-button active" data-tab="session" onclick="showTab('session')">
      <span class="icon">üöÄ</span><span>Session Mode</span>
    </button>
    <button class="tab-button" data-tab="workflow" onclick="showTab('workflow')">
      <span class="icon">üß≠</span><span>Daily Workflow</span>
    </button>
    <button class="tab-button" data-tab="palette" onclick="showTab('palette')">
      <span class="icon">üé®</span><span>Sound Palette</span>
    </button>
    <button class="tab-button" data-tab="groove" onclick="showTab('groove')">
      <span class="icon">ü•Å</span><span>Drum Grooves</span>
    </button>
    <button class="tab-button" data-tab="fill" onclick="showTab('fill')">
      <span class="icon">üéØ</span><span>Drum Fills</span>
    </button>
    <button class="tab-button" data-tab="texture" onclick="showTab('texture')">
      <span class="icon">üå´Ô∏è</span><span>Textures / Atmos</span>
    </button>
    <button class="tab-button" data-tab="arrange" onclick="showTab('arrange')">
      <span class="icon">üß±</span><span>Arrangement</span>
    </button>
    <button class="tab-button" data-tab="fx" onclick="showTab('fx')">
      <span class="icon">üéõÔ∏è</span><span>FX Chains</span>
    </button>
    <button class="tab-button" data-tab="constraints" onclick="showTab('constraints')">
      <span class="icon">üé≤</span><span>Constraints</span>
    </button>
    <button class="tab-button" data-tab="decks" onclick="showTab('decks')">
      <span class="icon">üóÇÔ∏è</span><span>Deck Editor</span>
    </button>
  </nav>

  <!-- SESSION MODE PANEL -->
  <section class="panel active" id="panel-session">
    <h2>Session Mode</h2>
    <p class="panel-description">
      One button to run a full creative flow: workflow ‚Üí palette ‚Üí groove ‚Üí textures ‚Üí arrangement ‚Üí FX ‚Üí constraints.
      You can tweak individual tabs afterwards and re-export.
    </p>
    <div class="export-row">
      <button class="primary" onclick="runSession()">Run Guided Session</button>
      <button onclick="exportSession()">Rebuild Summary Only</button>
    </div>

    <textarea id="session-export" placeholder="Click ‚ÄúRun Guided Session‚Äù to generate a full-session summary here."></textarea>
    <div class="export-row">
      <button onclick="copyText('session-export','session-status')">Copy</button>
    </div>
    <div class="status" id="session-status"></div>
    <p class="note">
      Tip: Use Session Mode at the start of a session, then live in the individual tabs while you build the track.
    </p>
  </section>

  <!-- Drum Fill Generator -->
  <section class="panel" id="panel-fill">
    <h2>Drum Fill Generator</h2>
    <p class="panel-description">Build fills from concepts instead of memorised patterns. Great for 1/4, 1/2 or 1-bar fills.</p>
    <button class="primary" onclick="generateFill()">Generate Drum Fill</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Structure</div>
          <button class="lock-btn" data-target="fill-structure" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fill-structure"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Rate / Rhythm</div>
          <button class="lock-btn" data-target="fill-rate" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fill-rate"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Timbre</div>
          <button class="lock-btn" data-target="fill-timbre" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fill-timbre"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Space / Density</div>
          <button class="lock-btn" data-target="fill-space" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fill-space"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">FX</div>
          <button class="lock-btn" data-target="fill-fx" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fill-fx"></p>
      </div>
    </div>

    <textarea id="fill-export" placeholder="Click ‚ÄúExport Fill Recipe‚Äù to dump this combo here."></textarea>
    <div class="export-row">
      <button onclick="exportFill()">Export Fill Recipe</button>
      <button onclick="copyText('fill-export','fill-status')">Copy</button>
    </div>
    <div class="status" id="fill-status"></div>
    <p class="note">Try to commit to each combo for a few minutes before rerolling. Treat it like a mini game.</p>
  </section>

  <!-- Drum Groove Generator -->
  <section class="panel" id="panel-groove">
    <h2>Drum Groove Generator</h2>
    <p class="panel-description">Design your core drum loop before touching samples. Especially good for organic house / downtempo.</p>
    <button class="primary" onclick="generateGroove()">Generate Groove</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Kick Pattern</div>
          <button class="lock-btn" data-target="groove-kick" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="groove-kick"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Snare / Clap</div>
          <button class="lock-btn" data-target="groove-snare" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="groove-snare"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Hats / Top</div>
          <button class="lock-btn" data-target="groove-hats" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="groove-hats"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Percussion</div>
          <button class="lock-btn" data-target="groove-perc" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="groove-perc"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Human Feel</div>
          <button class="lock-btn" data-target="groove-human" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="groove-human"></p>
      </div>
    </div>

    <textarea id="groove-export" placeholder="Click ‚ÄúExport Groove Recipe‚Äù to capture this groove plan."></textarea>
    <div class="export-row">
      <button onclick="exportGroove()">Export Groove Recipe</button>
      <button onclick="copyText('groove-export','groove-status')">Copy</button>
    </div>
    <div class="status" id="groove-status"></div>
  </section>

  <!-- Sound Palette Generator -->
  <section class="panel" id="panel-palette">
    <h2>Sound Palette Generator</h2>
    <p class="panel-description">Choose the sonic identity of the track before you start. This stops endless preset browsing.</p>
    <button class="primary" onclick="generatePalette()">Generate Palette</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Lead / Main Voice</div>
          <button class="lock-btn" data-target="pal-lead" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="pal-lead"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Bass Character</div>
          <button class="lock-btn" data-target="pal-bass" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="pal-bass"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Drum Tone</div>
          <button class="lock-btn" data-target="pal-drums" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="pal-drums"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">FX & Space</div>
          <button class="lock-btn" data-target="pal-fx" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="pal-fx"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Ambient Bed</div>
          <button class="lock-btn" data-target="pal-bed" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="pal-bed"></p>
      </div>
    </div>

    <textarea id="palette-export" placeholder="Export this palette and pin it in your project notes."></textarea>
    <div class="export-row">
      <button onclick="exportPalette()">Export Palette</button>
      <button onclick="copyText('palette-export','palette-status')">Copy</button>
    </div>
    <div class="status" id="palette-status"></div>
  </section>

  <!-- Texture / Atmos Generator -->
  <section class="panel" id="panel-texture">
    <h2>Texture / Atmos Generator</h2>
    <p class="panel-description">For evolving pads, noise beds, and risers built from everyday sounds.</p>
    <button class="primary" onclick="generateTexture()">Generate Texture Plan</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Source Material</div>
          <button class="lock-btn" data-target="tex-source" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="tex-source"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Time Manipulation</div>
          <button class="lock-btn" data-target="tex-time" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="tex-time"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Movement</div>
          <button class="lock-btn" data-target="tex-move" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="tex-move"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Processing Chain</div>
          <button class="lock-btn" data-target="tex-chain" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="tex-chain"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Role in Track</div>
          <button class="lock-btn" data-target="tex-role" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="tex-role"></p>
      </div>
    </div>

    <textarea id="texture-export" placeholder="Export the texture recipe so you can recreate it later."></textarea>
    <div class="export-row">
      <button onclick="exportTexture()">Export Texture</button>
      <button onclick="copyText('texture-export','texture-status')">Copy</button>
    </div>
    <div class="status" id="texture-status"></div>
  </section>

  <!-- Arrangement Expander -->
  <section class="panel" id="panel-arrange">
    <h2>Arrangement Expander</h2>
    <p class="panel-description">When you‚Äôre stuck in an 8-bar loop, use this to decide how the track evolves.</p>
    <button class="primary" onclick="generateArrangement()">Generate Arrangement Move</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Section Change</div>
          <button class="lock-btn" data-target="arr-section" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="arr-section"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Energy Shift</div>
          <button class="lock-btn" data-target="arr-energy" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="arr-energy"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Drum Variation</div>
          <button class="lock-btn" data-target="arr-drums" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="arr-drums"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Harmony / Melody</div>
          <button class="lock-btn" data-target="arr-harmony" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="arr-harmony"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Transition Trick</div>
          <button class="lock-btn" data-target="arr-transition" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="arr-transition"></p>
      </div>
    </div>

    <textarea id="arrange-export" placeholder="Export this as an arrangement TODO list for the project."></textarea>
    <div class="export-row">
      <button onclick="exportArrangement()">Export Arrangement Plan</button>
      <button onclick="copyText('arrange-export','arrange-status')">Copy</button>
    </div>
    <div class="status" id="arrange-status"></div>
  </section>

  <!-- Daily Workflow -->
  <section class="panel" id="panel-workflow">
    <h2>Daily Studio Workflow</h2>
    <p class="panel-description">A mini ‚Äútraining session‚Äù generator for when you sit down to make music and don‚Äôt know where to start.</p>
    <button class="primary" onclick="generateWorkflow()">Generate Today‚Äôs Session</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Warm-Up</div>
          <button class="lock-btn" data-target="wf-warmup" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="wf-warmup"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Core Creation Task</div>
          <button class="lock-btn" data-target="wf-core" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="wf-core"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Skill Practice</div>
          <button class="lock-btn" data-target="wf-skill" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="wf-skill"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Finishing / Admin</div>
          <button class="lock-btn" data-target="wf-finish" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="wf-finish"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Reflection</div>
          <button class="lock-btn" data-target="wf-reflect" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="wf-reflect"></p>
      </div>
    </div>

    <textarea id="workflow-export" placeholder="Use this as your checklist for today‚Äôs session."></textarea>
    <div class="export-row">
      <button onclick="exportWorkflow()">Export Session Plan</button>
      <button onclick="copyText('workflow-export','workflow-status')">Copy</button>
    </div>
    <div class="status" id="workflow-status"></div>
  </section>

  <!-- FX Chains -->
  <section class="panel" id="panel-fx">
    <h2>FX Chain Generator</h2>
    <p class="panel-description">Generate FX chains for different roles (drums, bass, leads, atmospheres) to explore new tones.</p>
    <button class="primary" onclick="generateFx()">Generate FX Chain</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Target</div>
          <button class="lock-btn" data-target="fx-target" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fx-target"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Core Processors</div>
          <button class="lock-btn" data-target="fx-core" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fx-core"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Movement / Mod</div>
          <button class="lock-btn" data-target="fx-mod" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fx-mod"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Space (Verb/Delay)</div>
          <button class="lock-btn" data-target="fx-space" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fx-space"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Special Sauce</div>
          <button class="lock-btn" data-target="fx-sauce" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="fx-sauce"></p>
      </div>
    </div>

    <textarea id="fx-export" placeholder="Export this chain and rebuild it in your DAW."></textarea>
    <div class="export-row">
      <button onclick="exportFx()">Export FX Chain</button>
      <button onclick="copyText('fx-export','fx-status')">Copy</button>
    </div>
    <div class="status" id="fx-status"></div>
  </section>

  <!-- Creative Constraints -->
  <section class="panel" id="panel-constraints">
    <h2>Creative Constraints</h2>
    <p class="panel-description">Use limitations as prompts: time, palette, arrangement, workflow.</p>
    <button class="primary" onclick="generateConstraints()">Generate Constraints</button>

    <div class="cards-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Time Box</div>
          <button class="lock-btn" data-target="cc-time" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="cc-time"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Track Scope</div>
          <button class="lock-btn" data-target="cc-scope" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="cc-scope"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Palette Restriction</div>
          <button class="lock-btn" data-target="cc-palette" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="cc-palette"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Arrangement Rule</div>
          <button class="lock-btn" data-target="cc-arrange" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="cc-arrange"></p>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Workflow Constraint</div>
          <button class="lock-btn" data-target="cc-workflow" type="button" onclick="toggleLock(this)">üîì</button>
        </div>
        <p class="card-content" id="cc-workflow"></p>
      </div>
    </div>

    <textarea id="constraints-export" placeholder="Export these and stick them in your session notes."></textarea>
    <div class="export-row">
      <button onclick="exportConstraints()">Export Constraints</button>
      <button onclick="copyText('constraints-export','constraints-status')">Copy</button>
    </div>
    <div class="status" id="constraints-status"></div>
  </section>

  <!-- Deck Editor -->
  <section class="panel" id="panel-decks">
    <h2>Deck Editor</h2>
    <p class="panel-description">
      Edit the idea lists used by all generators. Changes are saved locally on this device and won‚Äôt affect other machines.
    </p>

    <div class="deck-editor-row">
      <label for="deck-select">Choose deck:</label>
      <select id="deck-select" onchange="loadDeckIntoEditor()"></select>
    </div>

    <textarea id="deck-editor-text" placeholder="One item per line. Empty lines are ignored."></textarea>
    <div class="export-row">
      <button onclick="saveDeckFromEditor()">Save Changes</button>
      <button onclick="resetDeckFromEditor()">Reset to Default</button>
    </div>
    <div class="status" id="deck-editor-status"></div>
    <p class="note">Tip: write entries as short instructions, like advice to future-you.</p>
  </section>

  <script>
    // ---------- Utility ----------
    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function copyText(textareaId, statusId) {
      var area = document.getElementById(textareaId);
      if (!area.value.trim()) {
        document.getElementById(statusId).textContent = "Nothing to copy yet.";
        return;
      }
      area.select();
      try {
        var ok = document.execCommand("copy");
        document.getElementById(statusId).textContent = ok
          ? "Copied to clipboard ‚úî"
          : "Could not copy automatically, but text is selected.";
      } catch (e) {
        document.getElementById(statusId).textContent = "Copy failed, but text is selected.";
      }
    }

    // Lock helpers
    function toggleLock(btn) {
      btn.classList.toggle("locked");
      btn.textContent = btn.classList.contains("locked") ? "üîí" : "üîì";
    }

    function isLocked(targetId) {
      var btn = document.querySelector('.lock-btn[data-target="' + targetId + '"]');
      return btn && btn.classList.contains("locked");
    }

    // Theme toggle with persistence
    function applyTheme(theme) {
      var body = document.body;
      var toggle = document.getElementById("theme-toggle");
      if (theme === "dark") {
        body.classList.add("dark");
        toggle.textContent = "üåô Dark";
      } else {
        body.classList.remove("dark");
        toggle.textContent = "‚òÄ Light";
      }
    }

    function initTheme() {
      var saved = null;
      try {
        saved = localStorage.getItem("pt_theme");
      } catch (e) {}
      var theme = saved || "light";
      applyTheme(theme);

      var toggle = document.getElementById("theme-toggle");
      toggle.addEventListener("click", function () {
        var newTheme = document.body.classList.contains("dark") ? "light" : "dark";
        applyTheme(newTheme);
        try {
          localStorage.setItem("pt_theme", newTheme);
        } catch (e) {}
      });
    }

    // Tabs with persistence
    function showTab(name) {
      var buttons = document.querySelectorAll(".tab-button");
      buttons.forEach(function (btn) {
        btn.classList.toggle("active", btn.getAttribute("data-tab") === name);
      });

      var panels = document.querySelectorAll(".panel");
      panels.forEach(function (panel) {
        panel.classList.toggle("active", panel.id === "panel-" + name);
      });

      try {
        localStorage.setItem("pt_tab", name);
      } catch (e) {}
    }

    function initTabs() {
      var saved = null;
      try {
        saved = localStorage.getItem("pt_tab");
      } catch (e) {}
      var initial = saved || "session";
      showTab(initial);
    }

    // ---------- Decks (single source of truth) ----------
    const DEFAULT_DECKS = {
      // Drum fills
      "fill-structure": [
        "1/4-bar microfill right before the drop",
        "1/2-bar fill at the end of the phrase",
        "1-bar fill leading into a new section",
        "Microfill just before the snare on beat 4",
        "Stop-everything fill: full bar of tension then slam on 1",
        "Tiny pick-up fill using the last 2 beats only"
      ],
      "fill-rate": [
        "1/8 ‚Üí 1/16 acceleration across the fill",
        "Triplet burst then resolve back to straight 1/8",
        "3-note groupings over 4/4 (3-3-3-3 feel)",
        "Ratchet one element (e.g. hat) into 1/32 on the last beat",
        "Busy ‚Üí minimal, thinning hits towards beat 1",
        "Shift the last snare/clap early by a few ms for a pulled feel"
      ],
      "fill-timbre": [
        "Tuned tom run with melodic movement",
        "Foley clicks / paper crinkle as high percussion",
        "Noise burst shaped with a filter envelope",
        "Dry rimshot + clap stack as the main voice",
        "Mallet / marimba-style hits as a percussive melody",
        "Seed shaker or small hand percussion chopped into hits",
        "Reverse cymbal or whoosh layered behind each hit"
      ],
      "fill-space": [
        "Remove the kick entirely in the fill bar",
        "Mute hats: only toms / perc and silence",
        "Leave the last half-beat completely empty before the drop",
        "Mono, dry fill after a wide, wet groove",
        "Ghost notes swelling in density towards beat 1",
        "Low-only fill (sub + toms) with no highs",
        "High-only fill (hats / clicks) with no lows"
      ],
      "fill-fx": [
        "Single delay throw on one key hit (1/8 or 1/4 note)",
        "Reverse reverb swell into the downbeat",
        "Low-pass filter sweep down, then hard open on 1",
        "Short grain delay stutter on a clap or tom",
        "Resonator tuned to 5ths on a noise burst",
        "Freeze a reverb tail, resample, then chop it as fill material",
        "Subtle phaser or flanger moving across the fill only"
      ],

      // Grooves
      "groove-kick": [
        "Four-on-the-floor with occasional skip on bar 4",
        "Broken kick pattern with gaps on beat 3",
        "Sparse kicks only on 1 and the '&' of 3",
        "Syncopated pattern: 1, 2&, 3&, 4",
        "Half-time kick pattern for laid-back groove",
        "Steady 4/4 in verse, add ghost kicks in pre-drop"
      ],
      "groove-snare": [
        "Standard 2 & 4 clap with light flam on bar 2",
        "Snare only on 3 for half-time feel",
        "Clap stack on 2 & 4, ghost rim on 4e",
        "Alternating rimshot and clap every bar",
        "Side-stick on 2 & 4 with extra hit before bar change",
        "Occasional snare drop-out on bar 4 for tension"
      ],
      "groove-hats": [
        "1/16 hats with 55% swing and accents on offbeats",
        "1/8 hats with occasional 1/16 fills at bar ends",
        "Triplet hats on every 4th bar",
        "Closed hats on offbeats, open hat on 4 leading to drop",
        "Alternating two hat samples for call-and-response",
        "Sparse top loop with shaker instead of hats"
      ],
      "groove-perc": [
        "Wooden perc hits on 2e and 4a",
        "Quiet conga loop tucked under the main groove",
        "Foley clicks panned randomly every few beats",
        "Low tom on the '&' of 2 every second bar",
        "Offbeat tambourine for extra bounce",
        "One-shot perc only on fills, not in main groove"
      ],
      "groove-human": [
        "Add small timing nudges: hats late, claps slightly early",
        "Vary hat velocities between 40‚Äì100 for human feel",
        "Randomly mute 1 kick or clap every 4‚Äì8 bars",
        "Use groove template with light swing on all drums",
        "Let one perc element be fully unquantised",
        "Humanise only ghost notes, keep main hits tight"
      ],

      // Palette
      "pal-lead": [
        "Soft FM bell lead with slow attack and vibrato",
        "Warm analog saw lead with slight drift",
        "Plucked harp-like synth with short decay",
        "Glass pad doubling a simple motif",
        "Muted guitar-style pluck through tape delay",
        "Breathy vocal-like lead with formant movement"
      ],
      "pal-bass": [
        "Subby sine with gentle sidechain",
        "Plucked mid-bass with slight saturation",
        "Reese-style bass filtered for warmth",
        "Acoustic-style upright bass sample, low-passed",
        "Short 808 notes with minimal glide",
        "Moog-ish round bass with soft attack"
      ],
      "pal-drums": [
        "Dry, close-mic‚Äôd drums with light room verb",
        "Crunchy but soft-saturated kit, no harsh highs",
        "Main kit from analog drum machine, tops from foley",
        "Brush-style snare with shaker tops",
        "Tight, short kicks and clicky snares",
        "Deep kick with fluffy top, hats slightly dark"
      ],
      "pal-fx": [
        "Short room verb on drums, long shimmer only on select hits",
        "Mono delays inside a wide reverb",
        "Filtered dub-style delays for sends",
        "Subtle chorus on pads, no chorus on bass",
        "Only high elements get long reverb tails",
        "One main delay type used across all elements"
      ],
      "pal-bed": [
        "Vinyl crackle and low crowd murmur",
        "Forest ambience with distant birds",
        "Subtle city hum with distant traffic",
        "Soft ocean noise low-passed",
        "Airy noise from synth as constant bed",
        "Mechanical hum / fan noise filtered and sidechained"
      ],

      // Texture
      "tex-source": [
        "Single piano note or chord",
        "Metal hit from kitchen object",
        "Field recording from your phone (street, birds, room tone)",
        "Old vocal phrase or chant",
        "Drum loop bounced to audio",
        "One sustained synth note with filter movement"
      ],
      "tex-time": [
        "Extreme time-stretch until it becomes a pad",
        "Reverse then slice into overlapping layers",
        "Granular stretch with random grain position",
        "Loop a tiny portion to create a tonal drone",
        "Use long crossfades between multiple copies",
        "Create a slow tremolo pattern with volume automation"
      ],
      "tex-move": [
        "Slow autopan across stereo field",
        "Random LFO on filter cutoff",
        "Slow pitch LFO for wobble",
        "Volume swells tied to sidechain trigger",
        "Random panning of different texture layers",
        "Automation curves for rise and fall every 8 bars"
      ],
      "tex-chain": [
        "EQ ‚Üí saturation ‚Üí chorus ‚Üí reverb",
        "Band-pass filter ‚Üí delay ‚Üí reverb",
        "Granular effect ‚Üí HP filter ‚Üí shimmer",
        "Bitcrush ‚Üí low-pass ‚Üí long reverb tail",
        "Resonator tuned to key ‚Üí stereo delay",
        "Compressor sidechained to kick ‚Üí big hall verb"
      ],
      "tex-role": [
        "Constant background pad filling midrange",
        "Riser into each new section",
        "Occasional swell before fills or drops",
        "Low, almost subliminal tension layer",
        "Main texture in breakdown, nearly solo",
        "Transition glue between contrasting sections"
      ],

      // Arrangement
      "arr-section": [
        "Introduce a clear B-section with new chord voicing",
        "Strip back to only drums and bass for 8 bars",
        "Drop all drums and focus on pads for the breakdown",
        "Bring in a short bridge with new motif then return",
        "Double the length of the current loop and vary every 4 bars",
        "Create an intro that reveals elements one by one"
      ],
      "arr-energy": [
        "Pull energy down by muting the kick for 4 bars",
        "Gradually add layers every 2 bars for a rising feel",
        "Switch to half-time for 8 bars then slam back",
        "Remove bass for one phrase to create tension",
        "Filter sweep the whole mix down then open on drop",
        "Add an extra percussion layer only in the high-energy section"
      ],
      "arr-drums": [
        "Alternate between two slightly different grooves every 4 bars",
        "Add hat variations only on the last bar of each phrase",
        "Use tom fills as transitions into new sections",
        "Change clap pattern in the B-section for contrast",
        "Mute all tops and leave only kick + sub for a minimal passage",
        "Bring in a new percussion motif in the second half of the track"
      ],
      "arr-harmony": [
        "Add a simple 2-note counter-melody on top of the chords",
        "Change one chord in the progression for the B-section",
        "Move pad voicings up an octave in the more intense section",
        "Introduce a call-and-response motif between two instruments",
        "Add a pedal tone in the bass during the breakdown",
        "Use a modal shift (borrowed chord) for 4 bars as a surprise"
      ],
      "arr-transition": [
        "Noise sweep + drum fill into the new section",
        "Silence on the last half-beat before the drop",
        "Reverse reverb into the first hit of the next phrase",
        "Tape stop effect on the master for one beat",
        "Gradual HP filter on drums then sudden release",
        "Stutter the last beat of the bar into the next section"
      ],

      // Workflow
      "wf-warmup": [
        "5‚Äì10 minutes of sound design: create one new preset",
        "Program a simple 4-bar drum loop from scratch",
        "Jam on your MIDI keyboard to a drone in one key",
        "Tidy your sample folders for 5 minutes",
        "Recreate a drum groove from a reference track by ear",
        "Practice a scale or mode over a metronome"
      ],
      "wf-core": [
        "Extend one 8-bar loop into a 32-bar structure",
        "Write a brand new 8-bar idea with drums, bass, and one lead",
        "Replace all drums in an old project with a new kit",
        "Focus on basslines: write 3 different bass ideas for one groove",
        "Turn one sketch into a rough full arrangement",
        "Create a full set of fills for one track"
      ],
      "wf-skill": [
        "Practice EQ moves on drums using a reference",
        "Study and recreate the sidechain feel from a favourite track",
        "Watch one short tutorial and immediately apply the idea",
        "Practice comping and voice-leading on chords for 10 minutes",
        "Create 3 different FX chains for one sound",
        "Do a quick ear-training session (intervals, chords, or rhythms)"
      ],
      "wf-finish": [
        "Name and colour all tracks in your current project",
        "Bounce a rough mix and take quick notes on improvements",
        "Clean up unused channels and samples in one project",
        "Organise your ‚Äúideas‚Äù folder and star your 3 favourites",
        "Write a short description of the vibe and reference tracks",
        "Commit to either finishing or archiving one old idea"
      ],
      "wf-reflect": [
        "Write 2‚Äì3 sentences about what worked well today",
        "Note one thing to try differently next session",
        "List one technical skill and one musical skill to improve",
        "Capture one sentence about the emotional feel of your best idea",
        "Give the session a rating out of 10 and why",
        "Write down one tiny win you‚Äôre proud of"
      ],

      // FX Chains
      "fx-target": [
        "Drum bus (all drums)",
        "Kick + bass group",
        "Main lead synth",
        "Pad / atmosphere bus",
        "FX / riser channel",
        "Vocal or vocal chop bus"
      ],
      "fx-core": [
        "EQ ‚Üí gentle saturation ‚Üí compressor (glue)",
        "HP filter ‚Üí transient shaper ‚Üí bus compressor",
        "Tilt EQ ‚Üí tape saturation ‚Üí clipper",
        "Multiband saturation ‚Üí precise EQ cleanup",
        "Soft clipper ‚Üí limiter (for controlled aggression)",
        "Dynamic EQ ‚Üí compressor sidechained from kick"
      ],
      "fx-mod": [
        "Slow LFO on filter cutoff synced to 2‚Äì4 bars",
        "Envelope follower on filter from drum level",
        "Subtle chorus or doubler with mix under 20%",
        "Auto-pan synced to tempo on high frequencies only",
        "Random LFO on a band-pass filter",
        "Sidechained volume shaper from the kick pattern"
      ],
      "fx-space": [
        "Short room reverb (10‚Äì20% wet) for glue",
        "Send to a long hall reverb with sidechain ducking",
        "Mono delay into stereo reverb for width",
        "1/8 dotted delay feeding a plate reverb",
        "Spring-style reverb on mids only (HP/LP filtered)",
        "No verb, only tempo-synced delay for clarity"
      ],
      "fx-sauce": [
        "Bitcrush only the highs with a band-split",
        "Granular / spectral effect at very low mix",
        "Resonator bank tuned to the track‚Äôs key",
        "Pitch shifter up a 5th mixed very low",
        "Frequency shifter moving slowly over time",
        "Parallel ‚Äòdestroyed‚Äô channel blended at 5‚Äì10% wet"
      ],

      // Creative Constraints
      "cc-time": [
        "Write for 25 minutes, then stop and bounce whatever you have.",
        "1-hour session maximum: arrangement over perfection.",
        "10-minute idea sprint: only drums and bass.",
        "30 minutes to turn one old loop into a new section.",
        "15-minute sound design sprint, then commit: no tweaking after.",
        "Work in 3x 15-minute blocks with 5-minute breaks."
      ],
      "cc-scope": [
        "Track must be under 3 minutes.",
        "Only make a loop and a B-section, nothing more.",
        "Focus only on intro + first drop.",
        "Make a 60‚Äì90 second vignette, not a full song.",
        "Only structure: intro ‚Üí main ‚Üí breakdown ‚Üí outro.",
        "One idea per track: no key changes, no extra sections."
      ],
      "cc-palette": [
        "Use only one synth for all melodic parts.",
        "Drums must come only from foley / recorded sounds.",
        "Max 8 audio/MIDI tracks total.",
        "No more than 3 drum elements at once (kick, snare, one top).",
        "Only one reverb and one delay plugin allowed.",
        "Work in mono until the final 10 minutes."
      ],
      "cc-arrange": [
        "Something must change every 8 bars (mute, add, filter, etc.).",
        "No copy-paste: every repeated section has at least one variation.",
        "At least one full bar of silence somewhere in the track.",
        "Each main section must introduce or remove one element.",
        "Use a drum fill into every new major section.",
        "End the track by stripping back to the original idea."
      ],
      "cc-workflow": [
        "No preset browsing: use the first usable sound you land on.",
        "No looking at the screen while jamming ideas (turn monitor away or dim).",
        "Freeze and flatten tracks as soon as you‚Äôre happy with the sound.",
        "No solo button use: mix in context only.",
        "Pick one reference track and compare every 15 minutes.",
        "No more than 2 plugins per channel, except utility/sidechain."
      ]
    };

    const DECK_META = {
      "fill-structure": "Fill ‚Äì Structure",
      "fill-rate": "Fill ‚Äì Rate / Rhythm",
      "fill-timbre": "Fill ‚Äì Timbre",
      "fill-space": "Fill ‚Äì Space / Density",
      "fill-fx": "Fill ‚Äì FX",

      "groove-kick": "Groove ‚Äì Kick Pattern",
      "groove-snare": "Groove ‚Äì Snare / Clap",
      "groove-hats": "Groove ‚Äì Hats / Tops",
      "groove-perc": "Groove ‚Äì Percussion",
      "groove-human": "Groove ‚Äì Human Feel",

      "pal-lead": "Palette ‚Äì Lead / Main Voice",
      "pal-bass": "Palette ‚Äì Bass",
      "pal-drums": "Palette ‚Äì Drum Tone",
      "pal-fx": "Palette ‚Äì FX / Space",
      "pal-bed": "Palette ‚Äì Ambient Bed",

      "tex-source": "Texture ‚Äì Source",
      "tex-time": "Texture ‚Äì Time Manipulation",
      "tex-move": "Texture ‚Äì Movement",
      "tex-chain": "Texture ‚Äì Processing Chain",
      "tex-role": "Texture ‚Äì Role in Track",

      "arr-section": "Arrangement ‚Äì Section Change",
      "arr-energy": "Arrangement ‚Äì Energy Shift",
      "arr-drums": "Arrangement ‚Äì Drum Variation",
      "arr-harmony": "Arrangement ‚Äì Harmony / Melody",
      "arr-transition": "Arrangement ‚Äì Transition Trick",

      "wf-warmup": "Workflow ‚Äì Warm-Up",
      "wf-core": "Workflow ‚Äì Core Creation",
      "wf-skill": "Workflow ‚Äì Skill Practice",
      "wf-finish": "Workflow ‚Äì Finishing / Admin",
      "wf-reflect": "Workflow ‚Äì Reflection",

      "fx-target": "FX ‚Äì Target",
      "fx-core": "FX ‚Äì Core Processors",
      "fx-mod": "FX ‚Äì Movement / Modulation",
      "fx-space": "FX ‚Äì Space (Verb/Delay)",
      "fx-sauce": "FX ‚Äì Special Sauce",

      "cc-time": "Constraints ‚Äì Time Box",
      "cc-scope": "Constraints ‚Äì Scope",
      "cc-palette": "Constraints ‚Äì Palette",
      "cc-arrange": "Constraints ‚Äì Arrangement Rule",
      "cc-workflow": "Constraints ‚Äì Workflow"
    };

    let decks = {};

    function loadDecks() {
      let loaded = null;
      try {
        const raw = localStorage.getItem("pt_decks");
        if (raw) loaded = JSON.parse(raw);
      } catch (e) {
        loaded = null;
      }

      decks = {};
      for (const key in DEFAULT_DECKS) {
        if (loaded && Array.isArray(loaded[key])) {
          decks[key] = loaded[key];
        } else {
          decks[key] = DEFAULT_DECKS[key].slice();
        }
      }
    }

    function saveDecks() {
      try {
        localStorage.setItem("pt_decks", JSON.stringify(decks));
      } catch (e) {}
    }

    function pickFromDeck(deckId) {
      const list = decks[deckId] || [];
      if (!list.length) return "(no options defined)";
      return pickRandom(list);
    }

    // ---------- Generators & Exports ----------

    // Drum Fill
    function generateFill() {
      if (!isLocked("fill-structure"))
        document.getElementById("fill-structure").textContent = pickFromDeck("fill-structure");
      if (!isLocked("fill-rate"))
        document.getElementById("fill-rate").textContent = pickFromDeck("fill-rate");
      if (!isLocked("fill-timbre"))
        document.getElementById("fill-timbre").textContent = pickFromDeck("fill-timbre");
      if (!isLocked("fill-space"))
        document.getElementById("fill-space").textContent = pickFromDeck("fill-space");
      if (!isLocked("fill-fx"))
        document.getElementById("fill-fx").textContent = pickFromDeck("fill-fx");
      document.getElementById("fill-status").textContent = "";
    }

    function exportFill() {
      var lines = [
        "Drum Fill Recipe:",
        "- Structure: " + (document.getElementById("fill-structure").textContent || "(none)"),
        "- Rate / Rhythm: " + (document.getElementById("fill-rate").textContent || "(none)"),
        "- Timbre: " + (document.getElementById("fill-timbre").textContent || "(none)"),
        "- Space / Density: " + (document.getElementById("fill-space").textContent || "(none)"),
        "- FX: " + (document.getElementById("fill-fx").textContent || "(none)")
      ];
      document.getElementById("fill-export").value = lines.join("\n");
      document.getElementById("fill-status").textContent = "Export updated.";
    }

    // Groove
    function generateGroove() {
      if (!isLocked("groove-kick"))
        document.getElementById("groove-kick").textContent = pickFromDeck("groove-kick");
      if (!isLocked("groove-snare"))
        document.getElementById("groove-snare").textContent = pickFromDeck("groove-snare");
      if (!isLocked("groove-hats"))
        document.getElementById("groove-hats").textContent = pickFromDeck("groove-hats");
      if (!isLocked("groove-perc"))
        document.getElementById("groove-perc").textContent = pickFromDeck("groove-perc");
      if (!isLocked("groove-human"))
        document.getElementById("groove-human").textContent = pickFromDeck("groove-human");
      document.getElementById("groove-status").textContent = "";
    }

    function exportGroove() {
      var lines = [
        "Drum Groove Recipe:",
        "- Kick: " + (document.getElementById("groove-kick").textContent || "(none)"),
        "- Snare / Clap: " + (document.getElementById("groove-snare").textContent || "(none)"),
        "- Hats / Top: " + (document.getElementById("groove-hats").textContent || "(none)"),
        "- Percussion: " + (document.getElementById("groove-perc").textContent || "(none)"),
        "- Human Feel: " + (document.getElementById("groove-human").textContent || "(none)")
      ];
      document.getElementById("groove-export").value = lines.join("\n");
      document.getElementById("groove-status").textContent = "Export updated.";
    }

    // Palette
    function generatePalette() {
      if (!isLocked("pal-lead"))
        document.getElementById("pal-lead").textContent = pickFromDeck("pal-lead");
      if (!isLocked("pal-bass"))
        document.getElementById("pal-bass").textContent = pickFromDeck("pal-bass");
      if (!isLocked("pal-drums"))
        document.getElementById("pal-drums").textContent = pickFromDeck("pal-drums");
      if (!isLocked("pal-fx"))
        document.getElementById("pal-fx").textContent = pickFromDeck("pal-fx");
      if (!isLocked("pal-bed"))
        document.getElementById("pal-bed").textContent = pickFromDeck("pal-bed");
      document.getElementById("palette-status").textContent = "";
    }

    function exportPalette() {
      var lines = [
        "Sound Palette:",
        "- Lead / Main Voice: " + (document.getElementById("pal-lead").textContent || "(none)"),
        "- Bass Character: " + (document.getElementById("pal-bass").textContent || "(none)"),
        "- Drum Tone: " + (document.getElementById("pal-drums").textContent || "(none)"),
        "- FX & Space: " + (document.getElementById("pal-fx").textContent || "(none)"),
        "- Ambient Bed: " + (document.getElementById("pal-bed").textContent || "(none)")
      ];
      document.getElementById("palette-export").value = lines.join("\n");
      document.getElementById("palette-status").textContent = "Export updated.";
    }

    // Texture
    function generateTexture() {
      if (!isLocked("tex-source"))
        document.getElementById("tex-source").textContent = pickFromDeck("tex-source");
      if (!isLocked("tex-time"))
        document.getElementById("tex-time").textContent = pickFromDeck("tex-time");
      if (!isLocked("tex-move"))
        document.getElementById("tex-move").textContent = pickFromDeck("tex-move");
      if (!isLocked("tex-chain"))
        document.getElementById("tex-chain").textContent = pickFromDeck("tex-chain");
      if (!isLocked("tex-role"))
        document.getElementById("tex-role").textContent = pickFromDeck("tex-role");
      document.getElementById("texture-status").textContent = "";
    }

    function exportTexture() {
      var lines = [
        "Texture / Atmos Recipe:",
        "- Source: " + (document.getElementById("tex-source").textContent || "(none)"),
        "- Time Manipulation: " + (document.getElementById("tex-time").textContent || "(none)"),
        "- Movement: " + (document.getElementById("tex-move").textContent || "(none)"),
        "- Processing Chain: " + (document.getElementById("tex-chain").textContent || "(none)"),
        "- Role in Track: " + (document.getElementById("tex-role").textContent || "(none)")
      ];
      document.getElementById("texture-export").value = lines.join("\n");
      document.getElementById("texture-status").textContent = "Export updated.";
    }

    // Arrangement
    function generateArrangement() {
      if (!isLocked("arr-section"))
        document.getElementById("arr-section").textContent = pickFromDeck("arr-section");
      if (!isLocked("arr-energy"))
        document.getElementById("arr-energy").textContent = pickFromDeck("arr-energy");
      if (!isLocked("arr-drums"))
        document.getElementById("arr-drums").textContent = pickFromDeck("arr-drums");
      if (!isLocked("arr-harmony"))
        document.getElementById("arr-harmony").textContent = pickFromDeck("arr-harmony");
      if (!isLocked("arr-transition"))
        document.getElementById("arr-transition").textContent = pickFromDeck("arr-transition");
      document.getElementById("arrange-status").textContent = "";
    }

    function exportArrangement() {
      var lines = [
        "Arrangement Plan:",
        "- Section Change: " + (document.getElementById("arr-section").textContent || "(none)"),
        "- Energy Shift: " + (document.getElementById("arr-energy").textContent || "(none)"),
        "- Drum Variation: " + (document.getElementById("arr-drums").textContent || "(none)"),
        "- Harmony / Melody: " + (document.getElementById("arr-harmony").textContent || "(none)"),
        "- Transition Trick: " + (document.getElementById("arr-transition").textContent || "(none)")
      ];
      document.getElementById("arrange-export").value = lines.join("\n");
      document.getElementById("arrange-status").textContent = "Export updated.";
    }

    // Workflow
    function generateWorkflow() {
      if (!isLocked("wf-warmup"))
        document.getElementById("wf-warmup").textContent = pickFromDeck("wf-warmup");
      if (!isLocked("wf-core"))
        document.getElementById("wf-core").textContent = pickFromDeck("wf-core");
      if (!isLocked("wf-skill"))
        document.getElementById("wf-skill").textContent = pickFromDeck("wf-skill");
      if (!isLocked("wf-finish"))
        document.getElementById("wf-finish").textContent = pickFromDeck("wf-finish");
      if (!isLocked("wf-reflect"))
        document.getElementById("wf-reflect").textContent = pickFromDeck("wf-reflect");
      document.getElementById("workflow-status").textContent = "";
    }

    function exportWorkflow() {
      var lines = [
        "Today‚Äôs Session Plan:",
        "- Warm-Up: " + (document.getElementById("wf-warmup").textContent || "(none)"),
        "- Core Creation Task: " + (document.getElementById("wf-core").textContent || "(none)"),
        "- Skill Practice: " + (document.getElementById("wf-skill").textContent || "(none)"),
        "- Finishing / Admin: " + (document.getElementById("wf-finish").textContent || "(none)"),
        "- Reflection Prompt: " + (document.getElementById("wf-reflect").textContent || "(none)")
      ];
      document.getElementById("workflow-export").value = lines.join("\n");
      document.getElementById("workflow-status").textContent = "Export updated.";
    }

    // FX Chains
    function generateFx() {
      if (!isLocked("fx-target"))
        document.getElementById("fx-target").textContent = pickFromDeck("fx-target");
      if (!isLocked("fx-core"))
        document.getElementById("fx-core").textContent = pickFromDeck("fx-core");
      if (!isLocked("fx-mod"))
        document.getElementById("fx-mod").textContent = pickFromDeck("fx-mod");
      if (!isLocked("fx-space"))
        document.getElementById("fx-space").textContent = pickFromDeck("fx-space");
      if (!isLocked("fx-sauce"))
        document.getElementById("fx-sauce").textContent = pickFromDeck("fx-sauce");
      document.getElementById("fx-status").textContent = "";
    }

    function exportFx() {
      var lines = [
        "FX Chain:",
        "- Target: " + (document.getElementById("fx-target").textContent || "(none)"),
        "- Core Processors: " + (document.getElementById("fx-core").textContent || "(none)"),
        "- Movement / Mod: " + (document.getElementById("fx-mod").textContent || "(none)"),
        "- Space: " + (document.getElementById("fx-space").textContent || "(none)"),
        "- Special Sauce: " + (document.getElementById("fx-sauce").textContent || "(none)")
      ];
      document.getElementById("fx-export").value = lines.join("\n");
      document.getElementById("fx-status").textContent = "Export updated.";
    }

    // Constraints
    function generateConstraints() {
      if (!isLocked("cc-time"))
        document.getElementById("cc-time").textContent = pickFromDeck("cc-time");
      if (!isLocked("cc-scope"))
        document.getElementById("cc-scope").textContent = pickFromDeck("cc-scope");
      if (!isLocked("cc-palette"))
        document.getElementById("cc-palette").textContent = pickFromDeck("cc-palette");
      if (!isLocked("cc-arrange"))
        document.getElementById("cc-arrange").textContent = pickFromDeck("cc-arrange");
      if (!isLocked("cc-workflow"))
        document.getElementById("cc-workflow").textContent = pickFromDeck("cc-workflow");
      document.getElementById("constraints-status").textContent = "";
    }

    function exportConstraints() {
      var lines = [
        "Creative Constraints:",
        "- Time Box: " + (document.getElementById("cc-time").textContent || "(none)"),
        "- Track Scope: " + (document.getElementById("cc-scope").textContent || "(none)"),
        "- Palette Restriction: " + (document.getElementById("cc-palette").textContent || "(none)"),
        "- Arrangement Rule: " + (document.getElementById("cc-arrange").textContent || "(none)"),
        "- Workflow Constraint: " + (document.getElementById("cc-workflow").textContent || "(none)")
      ];
      document.getElementById("constraints-export").value = lines.join("\n");
      document.getElementById("constraints-status").textContent = "Export updated.";
    }

    // ---------- Session Mode ----------
    function runSession() {
      // Generate in a sensible order
      generateWorkflow();
      generatePalette();
      generateGroove();
      generateTexture();
      generateArrangement();
      generateFx();
      generateConstraints();

      exportSession();
      document.getElementById("session-status").textContent =
        "Session generated. Adjust individual tabs if you like, then hit ‚ÄúRebuild Summary Only‚Äù.";
    }

    function exportSession() {
      var lines = [];

      lines.push("=== DAILY WORKFLOW ===");
      lines.push("- Warm-Up: " + (document.getElementById("wf-warmup").textContent || "(none)"));
      lines.push("- Core Creation: " + (document.getElementById("wf-core").textContent || "(none)"));
      lines.push("- Skill Practice: " + (document.getElementById("wf-skill").textContent || "(none)"));
      lines.push("- Finishing / Admin: " + (document.getElementById("wf-finish").textContent || "(none)"));
      lines.push("- Reflection: " + (document.getElementById("wf-reflect").textContent || "(none)"));
      lines.push("");

      lines.push("=== SOUND PALETTE ===");
      lines.push("- Lead: " + (document.getElementById("pal-lead").textContent || "(none)"));
      lines.push("- Bass: " + (document.getElementById("pal-bass").textContent || "(none)"));
      lines.push("- Drums: " + (document.getElementById("pal-drums").textContent || "(none)"));
      lines.push("- FX & Space: " + (document.getElementById("pal-fx").textContent || "(none)"));
      lines.push("- Ambient Bed: " + (document.getElementById("pal-bed").textContent || "(none)"));
      lines.push("");

      lines.push("=== DRUM GROOVE ===");
      lines.push("- Kick: " + (document.getElementById("groove-kick").textContent || "(none)"));
      lines.push("- Snare / Clap: " + (document.getElementById("groove-snare").textContent || "(none)"));
      lines.push("- Hats / Tops: " + (document.getElementById("groove-hats").textContent || "(none)"));
      lines.push("- Percussion: " + (document.getElementById("groove-perc").textContent || "(none)"));
      lines.push("- Human Feel: " + (document.getElementById("groove-human").textContent || "(none)"));
      lines.push("");

      lines.push("=== TEXTURE / ATMOS ===");
      lines.push("- Source: " + (document.getElementById("tex-source").textContent || "(none)"));
      lines.push("- Time Manipulation: " + (document.getElementById("tex-time").textContent || "(none)"));
      lines.push("- Movement: " + (document.getElementById("tex-move").textContent || "(none)"));
      lines.push("- Processing Chain: " + (document.getElementById("tex-chain").textContent || "(none)"));
      lines.push("- Role: " + (document.getElementById("tex-role").textContent || "(none)"));
      lines.push("");

      lines.push("=== ARRANGEMENT PLAN ===");
      lines.push("- Section Change: " + (document.getElementById("arr-section").textContent || "(none)"));
      lines.push("- Energy Shift: " + (document.getElementById("arr-energy").textContent || "(none)"));
      lines.push("- Drum Variation: " + (document.getElementById("arr-drums").textContent || "(none)"));
      lines.push("- Harmony / Melody: " + (document.getElementById("arr-harmony").textContent || "(none)"));
      lines.push("- Transition Trick: " + (document.getElementById("arr-transition").textContent || "(none)"));
      lines.push("");

      lines.push("=== FX CHAIN ===");
      lines.push("- Target: " + (document.getElementById("fx-target").textContent || "(none)"));
      lines.push("- Core Processors: " + (document.getElementById("fx-core").textContent || "(none)"));
      lines.push("- Movement / Mod: " + (document.getElementById("fx-mod").textContent || "(none)"));
      lines.push("- Space: " + (document.getElementById("fx-space").textContent || "(none)"));
      lines.push("- Special Sauce: " + (document.getElementById("fx-sauce").textContent || "(none)"));
      lines.push("");

      lines.push("=== CREATIVE CONSTRAINTS ===");
      lines.push("- Time Box: " + (document.getElementById("cc-time").textContent || "(none)"));
      lines.push("- Track Scope: " + (document.getElementById("cc-scope").textContent || "(none)"));
      lines.push("- Palette Restriction: " + (document.getElementById("cc-palette").textContent || "(none)"));
      lines.push("- Arrangement Rule: " + (document.getElementById("cc-arrange").textContent || "(none)"));
      lines.push("- Workflow Constraint: " + (document.getElementById("cc-workflow").textContent || "(none)"));

      document.getElementById("session-export").value = lines.join("\n");
      document.getElementById("session-status").textContent = "Session summary updated.";
    }

    // ---------- Deck Editor ----------
    function initDeckEditor() {
      var select = document.getElementById("deck-select");
      select.innerHTML = "";

      Object.keys(DECK_META).forEach(function (key) {
        var opt = document.createElement("option");
        opt.value = key;
        opt.textContent = DECK_META[key];
        select.appendChild(opt);
      });

      loadDeckIntoEditor();
    }

    function loadDeckIntoEditor() {
      var select = document.getElementById("deck-select");
      var deckId = select.value;
      var textArea = document.getElementById("deck-editor-text");
      var status = document.getElementById("deck-editor-status");

      var list = decks[deckId] || [];
      textArea.value = list.join("\n");
      status.textContent = "";
    }

    function saveDeckFromEditor() {
      var select = document.getElementById("deck-select");
      var deckId = select.value;
      var textArea = document.getElementById("deck-editor-text");
      var status = document.getElementById("deck-editor-status");

      var lines = textArea.value.split("\n").map(function (l) {
        return l.trim();
      }).filter(function (l) {
        return l.length > 0;
      });

      decks[deckId] = lines;
      saveDecks();
      status.textContent = "Saved. Generators will use this updated deck.";
    }

    function resetDeckFromEditor() {
      var select = document.getElementById("deck-select");
      var deckId = select.value;
      var status = document.getElementById("deck-editor-status");

      decks[deckId] = DEFAULT_DECKS[deckId].slice();
      saveDecks();
      loadDeckIntoEditor();
      status.textContent = "Deck reset to default.";
    }

    // ---------- Init ----------
    document.addEventListener("DOMContentLoaded", function () {
      initTheme();
      loadDecks();
      initTabs();
      initDeckEditor();

      // Seed all tabs once (so Session Mode can read something even before first click)
      generateWorkflow();
      generatePalette();
      generateGroove();
      generateTexture();
      generateArrangement();
      generateFx();
      generateConstraints();
    });
  </script>
</body>
</html>
